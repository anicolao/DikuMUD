# Integration test for Shop #4: Kantos Kan, Admiral of the Fleet
#
# This test validates that the Admiral's shop at the Navy Headquarters
# allows players to list and purchase water and wine supplies.
#
# Shop Details:
# - Shop #4
# - Keeper: mob 3944 (Kantos Kan, Admiral of the Fleet)
# - Location: room 3935 (Navy location in Greater Helium)
# - Products: crystal water flask (3501), water cask (3500), vintage wine (3502)

test:
  id: test_shop_04_admiral
  description: "Verify Admiral's shop allows listing and purchasing drinks"
  author: Integration Test Framework
  created: 2025-10-13
  tags: [shop, water, wine, navy, greater_helium]

setup:
  character:
    name: TestChar
    class: warrior
    level: 5
  start_room: 3967  # Navy location
  gold: 1000

steps:
  # Step 1: Verify the Admiral is present
  - action: look
    description: "Look around to see the Admiral"
    expected:
      - pattern: "Admiral|Kantos Kan|Fleet"
        message: "Admiral should be visible in the room"

  # Step 2: List available items
  - action: command
    description: "List items for sale"
    command: "list"
    expected:
      - pattern: "water|cask|flask|wine|vintage"
        message: "Should show water and wine supplies for sale"
      - pattern: "\\d+.*gold|coins"
        message: "Should show prices in gold"
    fail_on:
      - pattern: "don't seem interested|ignores you|not interested in trading"
        message: "Shop should respond to list command"

  # Step 3: Purchase an item
  - action: command
    description: "Buy a water flask from the Admiral"
    command: "buy flask"
    expected:
      - pattern: "You buy|You purchase|You now have|coins"
        message: "Should be able to purchase a flask"

  # Step 4: Verify the item is in inventory
  - action: inventory
    description: "Check that flask is in inventory"
    expected:
      - pattern: "flask|water|crystal"
        message: "Purchased flask should be in inventory"

result:
  should_pass: true
  description: "Test passes when Admiral's shop is fully functional"
