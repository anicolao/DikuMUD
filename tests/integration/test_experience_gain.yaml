# Integration test for experience gain on kill
# Verifies that players see "You gained XX experience." when killing a creature

test:
  id: test_experience_gain
  description: "Verify players see experience gain message when killing creatures"
  author: Integration Test Framework
  created: 2025-10-11
  tags: [combat, experience, kill]

setup:
  character:
    name: ExpTester
    password: test
    class: warrior
    level: 22 # Level 22 to use god commands and maximize combat ability
  start_room: 1200 # room with no exits
  gold: 100

steps:
  # Step 1: Verify we're in the temple
  - action: look
    description: "Look around to confirm we're in the Chat Room"
    expected:
      - pattern: "Chat|chat"
        message: "Should be in chat room"

  # Step 2: Load a powerful weapon to ensure we can hit and kill quickly
  - action: command
    command: "load obj 4501"
    description: "Load a Kaolian ceremonial blade (5d4+3 damage)"
    expected:
      - pattern: "."
        message: "Should get some response from load command"

  # Step 3: Get the weapon
  - action: command
    command: "get blade"
    description: "Pick up the ceremonial blade"
    expected:
      - pattern: "."
        message: "Should pick up the weapon"

  # Step 4: Wield the weapon
  - action: command
    command: "wield blade"
    description: "Wield the powerful blade"
    expected:
      - pattern: "."
        message: "Should wield the weapon"

  # Step 5: Load a weak mobile to kill
  - action: command
    command: "load char 3062"
    description: "Load a weak calot for testing"
    expected:
      - pattern: "."
        message: "Should get some response from load command"

  # Step 6: Look to see what we loaded
  - action: look
    description: "Look to see the loaded mobile"
    expected:
      - pattern: "."
        message: "Should see something"

  # Step 7: Kill the mobile with the powerful weapon
  # With the Kaolian ceremonial blade (5d4+3 damage), we should kill quickly
  - action: command
    command: "kill calot"
    description: "Attack the calot with powerful weapon"
    delay_after: 3
    expected:
      - pattern: "."
        message: "Should start combat"

  # Step 8: Finish the kill and check for experience message
  - action: command
    command: "kill calot"
    description: "Finish the kill (if not already dead)"
    delay_after: 3
    expected:
      - pattern: "You gained [0-9]+ experience\\."
        message: "Should see experience gain message with actual amount"

result:
  should_pass: true
  description: "Test passes if we see 'You gained XX experience.' message on kill"
