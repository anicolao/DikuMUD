# Integration test for bug report: **Kheldar[3005]: lamp in temple of the jeddak has no light left
#
# This test validates that the lamp in the Temple of the Jeddak (room 3001 or nearby)
# has light charges remaining and can be used for illumination.
#
# Bug Description:
# Player Kheldar reported from room 3005 that a lamp in the temple area has
# no light remaining, making it useless for illumination in dark areas.
#
# Expected Behavior:
# - Lamp should exist in the temple area
# - Lamp should have light charges remaining
# - Lamp should be able to be lit or be already lit
# - Lamp should provide illumination

test:
  id: bug_3005_lamp_no_light
  description: "Verify temple lamp has light charges remaining"
  bug_report: "**Kheldar[3005]: lamp in temple of the jeddak has no light left"
  author: Integration Test Framework
  created: 2025-10-10
  tags: [item, bug_fix, temple, lamp, light]

setup:
  character:
    name: TestChar
    class: warrior
    level: 1
  start_room: 3001  # Start in Temple of the Jeddak where lamp actually is

steps:
  # Look for lamp in current room
  - action: look
    description: "Look for lamp in current room"
    expected:
      - pattern: "lamp|light|lantern"
        message: "Lamp should be visible in the temple area"

  # Try to pick up the lamp (should succeed if weight is appropriate)
  - action: command
    description: "Pick up the lamp"
    command: "get lamp"
    expected:
      - pattern: "You get|You take|Ok"
        message: "Should be able to pick up the lamp"
    fail_on:
      - pattern: "too heavy|can't carry|overweight|don't see"
        message: "BUG: Lamp should be light enough to pick up"

  # Check inventory to confirm we have the lamp
  - action: command
    description: "Check inventory for lamp"
    command: "inventory"
    expected:
      - pattern: "lamp|light"
        message: "Lamp should be in inventory"

  # Hold the lamp to light it (this equips it in the light slot)
  - action: command
    description: "Hold lamp to light it"
    command: "hold lamp"
    expected:
      - pattern: "Ok|You hold|You grab|already holding"
        message: "Should be able to hold the lamp"
    fail_on:
      - pattern: "don't have|can't hold|no light|empty"
        message: "BUG: Should be able to hold the lamp"

  # Verify lamp is equipped and providing light
  - action: command
    description: "Check equipment to see lamp is held"
    command: "equipment"
    expected:
      - pattern: "lamp|light|<used as light>"
        message: "Lamp should be equipped as light source"

  # Navigate to dark room: s s s s d (3001 -> 3005 -> 3014 -> 3025 -> 3030 -> 3150)
  - action: command
    description: "Go south from temple"
    command: "s"
    expected:
      - pattern: "Temple Plaza|plaza"
        message: "Should move to temple plaza (room 3005)"

  - action: command
    description: "Go south to market"
    command: "s"
    expected:
      - pattern: "Market Plaza|plaza"
        message: "Should move to market plaza (room 3014)"

  - action: command
    description: "Go south to common area"
    command: "s"
    expected:
      - pattern: "Common Plaza|plaza"
        message: "Should move to common plaza (room 3025)"

  - action: command
    description: "Go south to waste disposal"
    command: "s"
    expected:
      - pattern: "Waste Disposal|disposal"
        message: "Should move to waste disposal (room 3030)"

  - action: command
    description: "Go down into sewers (dark room)"
    command: "d"
    expected:
      - pattern: "Lower Sewer|sewer|tunnel"
        message: "Should descend into dark sewer area (room 3150)"

  # Verify we can see in the dark room because lamp is lit
  - action: command
    description: "Look in dark room with lamp lit"
    command: "look"
    expected:
      - pattern: "Lower Sewer|sewer|stone blocks|darkness"
        message: "Should be able to see room description with lamp providing light"
    fail_on:
      - pattern: "It is pitch black|too dark|can't see"
        message: "BUG: Lamp should illuminate the dark room"

result:
  should_pass: true
  description: "Temple lamp should be functional and provide light in dark areas"
  notes: |
    This test validates the complete lamp functionality:
    
    1. Lamp can be picked up (weight must be appropriate for level 1 characters)
    2. Lamp can be held/equipped as a light source
    3. Lamp has sufficient light charges (value[2] > 0)
    4. Lamp illuminates dark rooms when equipped
    
    Technical requirements:
    - Lamp object (3099) configured as ITEM_LIGHT (type_flag: 1)
    - Weight: 1 lb (light enough for any character to carry)
    - Light charges: value[2] >= 100 hours
    - Wear flags: ITEM_TAKE | ITEM_HOLD (16385)
    
    Test path: Room 3001 (Temple) -> 3005 -> 3014 -> 3025 -> 3030 -> 3150 (Dark Sewer)
    
    The dark room (3150) has DARK flag set, requiring a light source to see.
    With the lamp held, the player should be able to see the room description.
