test:
  id: test_secret_door_sewers
  description: Verify secret door in sewers (room 3165) is properly hidden and discoverable via floor examination
  author: Copilot
  created: '2025-10-16'
  tags: ['secret_door', 'sewers', 'room_3165']

setup:
  character:
    name: TestWizard
    password: test
    class: warrior
    level: 34
  start_room: 3165
  gold: 0

steps:
  # Test 1: Check initial state - does the secret door show in prompt?
  - action: command
    command: look
    description: Check room description and what exits are visible
    expected:
      - pattern: 'Ancient Eastern Passage'
      - pattern: 'floor stones are oddly fitted'

  # Test 2: Verify floor can be examined for clues
  - action: command
    command: look floor
    description: Examine the floor to discover clues about secret door
    expected:
      - pattern: 'floor tiles form a distinctive rectangular pattern'
      - pattern: 'slightly raised'
      - pattern: 'scrape marks'
      - pattern: 'breeze emanates from the cracks'

  # Test 3: Verify stones keyword also works
  - action: command
    command: look stones
    description: Examine stones should also show the secret door clue
    expected:
      - pattern: 'floor tiles form a distinctive rectangular pattern'

  # Test 4: Try to open the secret door using keywords
  - action: command
    command: open hatch
    description: Try to open the hatch (secret door) by keyword
    expected:
      - pattern: '.'

  # Test 5: Look at room after opening
  - action: command
    command: look
    description: After opening, check what changed
    expected:
      - pattern: 'Ancient Eastern Passage'

  # Test 6: Look south to see the door description
  - action: command
    command: look south
    description: Look at the now-open door to the south
    expected:
      - pattern: 'passage continues south'

  # Test 7: Go through the door
  - action: command
    command: south
    description: Go through the secret door to verify it works
    expected:
      - pattern: 'Secret Lower Level Access'
